
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Tower Map Visualization</title>
    <link rel="stylesheet" href="libs/neo4jd3.min.css">
    <style type="text/css">
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #d4c5b9;
            margin: 0;
            padding: 20px;
        }
        
        h1, h2, h3 {
            color: #d4af37;
        }
        
        #neo4jd3-container {
            width: 100%;
            height: 800px;
            border: 2px solid #8b4513;
            border-radius: 10px;
            background: #0a0a0a;
            margin-bottom: 40px;
        }
        
        .visualization-section {
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(20, 10, 15, 0.85);
            border: 2px solid #8b4513;
            border-radius: 10px;
        }
        
        .tab-buttons {
            margin-bottom: 20px;
        }
        
        .tab-button {
            background: #8b4513;
            color: #d4c5b9;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .tab-button:hover {
            background: #a0522d;
        }
        
        .tab-button.active {
            background: #d4af37;
            color: #1a1a1a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        img {
            width: auto;
            height: 400px;
        }
        
        span {
            font-family: monospace
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Shadow Tower Map Visualization</h1>
    
    <div class="tab-buttons">
        <button class="tab-button active" onclick="showTab('neo4j')">Interactive Graph (neo4jd3)</button>
        <button class="tab-button" onclick="showTab('mermaid')">Flowchart (Mermaid)</button>
        <button class="tab-button" onclick="showTab('details')">Area Details</button>
    </div>
    
    <!-- Neo4jd3 Interactive Graph -->
    <div id="neo4j-tab" class="tab-content active visualization-section">
        <h2>Interactive Area Connection Graph</h2>
        <p>Drag nodes to explore connections. Colored by world. Click nodes for details.</p>
        <div id="neo4jd3-container"></div>
        <p style="font-size: 0.9em; color: #b8a080;">
            <strong>Legend:</strong> Nodes represent areas, edges represent exits/jumps between areas. 
            Node size indicates progression difficulty/score.
        </p>
    </div>
    
    <!-- Mermaid Flowchart -->
    <div id="mermaid-tab" class="tab-content visualization-section">
        <h2>Mermaid Flowchart</h2>
<pre class="mermaid">
<!--mermaid-->
</pre>
    </div>
    
    <!-- Area Details -->
    <div id="details-tab" class="tab-content">
<style type="text/css">
    img {
      width: auto;
      height: 400px;
    }
    span {
      font-family: monospace
    }
</style>

<h2>Human World</h2>
<h3>human_world_solitary_region</h3><br>
<!--human_world_solitary_region-->
<img src="maps/human_world_solitary_region.png"/><br>
<h3>human_world_hidden_region</h3><br>
<!--human_world_hidden_region-->
<img src="maps/human_world_hidden_region.png"/><br>
<h3>human_world_forgotten_region</h3><br>
<!--human_world_forgotten_region-->
<img src="maps/human_world_forgotten_region.png"/><br>
<h3>human_world_cursed_region</h3><br>
<!--human_world_cursed_region-->
<img src="maps/human_world_cursed_region.png"/><br>

<h2>Earth World</h2>
<h3>earth_world_rotting_cavern</h3><br>
<!--earth_world_rotting_cavern-->
<img src="maps/earth_world_rotting_cavern.png"/><br>
<h3>earth_world_poisonous_cavern</h3><br>
<!--earth_world_poisonous_cavern-->
<img src="maps/earth_world_poisonous_cavern.png"/><br>
<h3>earth_world_stone_cavern</h3><br>
<!--earth_world_stone_cavern-->
<img src="maps/earth_world_stone_cavern.png"/><br>
<h3>earth_world_quaking_cavern</h3><br>
<!--earth_world_quaking_cavern-->
<img src="maps/earth_world_quaking_cavern.png"/><br>
<h3>earth_world_false_pit_cavern</h3><br>
<!--earth_world_false_pit_cavern-->
<img src="maps/earth_world_false_pit_cavern.png"/><br>
<h3>earth_world_hostile_rock_cavern</h3><br>
<!--earth_world_hostile_rock_cavern-->
<img src="maps/earth_world_hostile_rock_cavern.png"/><br>

<h2>Fire World</h2>
<h3>fire_world_burning_cavern</h3><br>
<!--fire_world_burning_cavern-->
<img src="maps/fire_world_burning_cavern.png"/><br>
<h3>fire_world_molten_cavern</h3><br>
<!--fire_world_molten_cavern-->
<img src="maps/fire_world_molten_cavern.png"/><br>
<h3>fire_world_phoenix_cave</h3><br>
<!--fire_world_phoenix_cave-->
<img src="maps/fire_world_phoenix_cave.png"/><br>
<h3>fire_world_ashen_cavern</h3><br>
<!--fire_world_ashen_cavern-->
<img src="maps/fire_world_ashen_cavern.png"/><br>

<h2>Water World</h2>
<h3>water_world_impure_pool_area</h3><br>
<!--water_world_impure_pool_area-->
<img src="maps/water_world_impure_pool_area.png"/><br>
<h3>water_world_sunken_river_area</h3><br>
<!--water_world_sunken_river_area-->
<img src="maps/water_world_sunken_river_area.png"/><br>
<h3>water_world_white_rain_area</h3><br>
<!--water_world_white_rain_area-->
<img src="maps/water_world_white_rain_area.png"/><br>
<h3>water_world_watery_labyrinth_area</h3><br>
<!--water_world_watery_labyrinth_area-->
<img src="maps/water_world_watery_labyrinth_area.png"/><br>

<h2>Monster World</h2>
<h3>monster_world_false_eye_area</h3><br>
<!--monster_world_false_eye_area-->
<img src="maps/monster_world_false_eye_area.png"/><br>
<h3>monster_world_screeching_area</h3><br>
<!--monster_world_screeching_area-->
<img src="maps/monster_world_screeching_area.png"/><br>

<h2>Illusion World</h2>
<h3>illusion_world_gloomy_domain</h3><br>
<!--illusion_world_gloomy_domain-->
<img src="maps/illusion_world_gloomy_domain.png"/><br>
<h3>illusion_world_bewilderment_domain</h3><br>
<!--illusion_world_bewilderment_domain-->
<img src="maps/illusion_world_bewilderment_domain.png"/><br>
<h3>illusion_world_worship_domain</h3><br>
<!--illusion_world_worship_domain-->
<img src="maps/illusion_world_worship_domain.png"/><br>
<h3>illusion_world_dream_domain</h3><br>
<!--illusion_world_dream_domain-->
<img src="maps/illusion_world_dream_domain.png"/><br>

<h2>Death World</h2>
<h3>death_world_dark_castle_layer</h3><br>
<!--death_world_dark_castle_layer-->
<img src="maps/death_world_dark_castle_layer.png"/><br>
<h3>death_world_gate_of_the_dead</h3><br>
<!--death_world_gate_of_the_dead-->
<img src="maps/death_world_gate_of_the_dead.png"/><br>
<h3>death_world_lingering_curse_layer</h3><br>
<!--death_world_lingering_curse_layer-->
<img src="maps/death_world_lingering_curse_layer.png"/><br>
<h3>death_world_undead_layer</h3><br>
<!--death_world_undead_layer-->
<img src="maps/death_world_undead_layer.png"/><br>

<h2>Shadow Tower</h2>
<h3>shadow_tower_part1</h3><br>
<!--shadow_tower_part1-->
<img src="maps/shadow_tower_part1.png"/><br>
<h3>shadow_tower_part2</h3><br>
<!--shadow_tower_part2-->
<img src="maps/shadow_tower_part2.png"/><br>
<h3>shadow_tower_part3</h3><br>
<!--shadow_tower_part3-->
<img src="maps/shadow_tower_part3.png"/><br>

<h2>Void</h2>
<h3>void</h3><br>
<!--void-->
<img src="maps/void.png"/><br>

</div> <!-- End details-tab -->

<!-- Neo4j Data -->
<script>
<!--neo4j-data-->
</script>

<!-- Neo4jd3 Library (Task 7: Fixed to use local files instead of CDN) -->
<script src="libs/d3.min.js"></script>
<script src="libs/neo4jd3.min.js"></script>

<!-- Tab Switching Script -->
<script>
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Deactivate all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Activate corresponding button
    event.target.classList.add('active');
}
</script>

<!-- Neo4jd3 Initialization -->
<script>
if (typeof neo4jGraphData !== 'undefined') {
    // Task 7: Configuration for neo4jd3 v0.0.5
    // Debug: Check data structure
    console.log('neo4jGraphData:', neo4jGraphData);
    console.log('Has nodes:', neo4jGraphData.nodes);
    console.log('Has relationships:', neo4jGraphData.relationships);
    
    // Define color palette for node coloring (assigned by label type automatically)
    var shadowTowerColors = [
        '#4a90e2', // human world - blue
        '#8b4513', // earth world - brown
        '#ff4500', // fire world - orange-red
        '#1e90ff', // water world - dodger blue
        '#9932cc', // monster world - purple
        '#ff1493', // illusion world - deep pink
        '#2f4f4f', // death world - dark slate
        '#000000', // shadow tower - black
        '#d4af37', // gold accent
        '#696969'  // void/default - gray
    ];
    
    try {
        // Create neo4jd3 visualization
        var neo4jd3 = new Neo4jd3('#neo4jd3-container', {
            colors: shadowTowerColors,
            highlight: [
                {
                    class: 'Area',
                    property: 'name',
                    value: 'shadow_tower'
                }
            ],
            infoPanel: true,
            minCollision: 60,
            neo4jData: neo4jGraphData,
            nodeRadius: 25,
            zoomFit: true
        });
        
        // Task 7: Add text labels to nodes after a short delay (wait for graph to render)
        setTimeout(function() {
            var svg = d3.select('#neo4jd3-container svg');
            var nodes = svg.selectAll('g.node');
            
            nodes.each(function(d) {
                var node = d3.select(this);
                // Check if text doesn't already exist
                if (node.select('text.area-label').empty()) {
                    // Get the area name and split it into parts for multi-line display
                    var fullName = d.properties && d.properties.name ? d.properties.name : d.id;
                    var words = fullName.split(' ');
                    var text = node.append('text')
                        .attr('class', 'area-label')
                        .attr('text-anchor', 'middle')
                        .attr('y', 0) // Center vertically in the circle
                        .attr('fill', '#ffffff')
                        .attr('font-size', '9px')
                        .attr('font-weight', 'bold')
                        .attr('pointer-events', 'none');
                    
                    // Add text as tspan elements for better wrapping
                    if (words.length <= 2) {
                        // Short names: single line
                        text.append('tspan')
                            .attr('x', 0)
                            .attr('dy', '0.3em')
                            .text(fullName);
                    } else if (words.length <= 4) {
                        // Medium names: two lines
                        var line1 = words.slice(0, 2).join(' ');
                        var line2 = words.slice(2).join(' ');
                        text.append('tspan')
                            .attr('x', 0)
                            .attr('dy', '-0.3em')
                            .text(line1);
                        text.append('tspan')
                            .attr('x', 0)
                            .attr('dy', '1.1em')
                            .text(line2);
                    } else {
                        // Long names: three lines
                        var line1 = words.slice(0, 2).join(' ');
                        var line2 = words.slice(2, 4).join(' ');
                        var line3 = words.slice(4).join(' ');
                        text.append('tspan')
                            .attr('x', 0)
                            .attr('dy', '-0.8em')
                            .text(line1);
                        text.append('tspan')
                            .attr('x', 0)
                            .attr('dy', '1.1em')
                            .text(line2);
                        if (line3) {
                            text.append('tspan')
                                .attr('x', 0)
                                .attr('dy', '1.1em')
                                .text(line3);
                        }
                    }
                }
            });
        }, 500);
    } catch (err) {
        console.error('Error creating Neo4jd3:', err);
        document.getElementById('neo4jd3-container').innerHTML = 
            '<p style="color: #ff6b6b; padding: 20px;">Error initializing graph: ' + err.message + '</p>';
    }
} else {
    document.getElementById('neo4jd3-container').innerHTML = 
        '<p style="color: #ff6b6b; padding: 20px;">Neo4j graph data not available. Please regenerate the map.</p>';
}
</script>

<script src="libs/mermaid.min.js"></script>
<script>
mermaid.initialize({ startOnLoad: true });
showTab('mermaid');
showTab('neo4j');

</script>